{"title":"Working with rhyme distances","markdown":{"yaml":{"title":"Working with rhyme distances","author":"Nick Danis","date":"last-modified"},"headingText":"code preamble","containsRefs":false,"markdown":"\n\n```{python}\n\nfrom rhyme_functions import *\n# import pygraphviz as pgv\nfrom pyeditdistance import distance as d\nimport pandas as pd\nimport graphviz\nfrom IPython.display import Image\n```\n\n## Introduction\n\nRhyme scheme information is presented in the tagged linegroup data in a variety of ways. One column contains the standard AABB-style rhyme schemes (henceforth 'AB-scheme'), and another contains the `rhyme_distances` (hereafter 'distance scheme'). In most situations where you will be searching, filtering, and comparing rhyme schemes, especially with the use of code, the rhyme distances will provide more flexibility and generality. \n\n### Types of schemes\n\n#### AB-schemes\n\nTo construct an AB-scheme generally, start at the last word of the first line of the stanza. Label this line 'A'. Any subsequent line that rhymes (meaning, the last word of that line rhymes with the last word of the current line), label those lines 'A'. Move to the next unlabeled line, and continue labeling with 'B', and so on, until all lines are labeled. \n\n| regularized text                                       | final word | AB-scheme |\n| :----------------------------------------------------- | :--------- | :-------- |\n| LO I the man, whose Muse whilom did mask,              | mask       | A         |\n| As time her taught, in lowly shepherds weeds,          | weeds      | B         |\n| Am now enforced a far unfitter task,                   | task       | A         |\n| For trumpets stern to change mine Oaten reeds:         | reeds      | B         |\n| And sing of Knights and Ladies gentle deeds,           | deeds      | B         |\n| Whose praises having slept in silence long,            | long       | C         |\n| Me, all too mean, the sacred Muse areeds               | areeds     | B         |\n| To blazon broad amongst her learned throng:            | throng     | C         |\n| Fierce wars and faithful loves shall moralise my song. | song       | C         |\n\n#### Distance schemes\n\nTo construct a distance scheme, start at the first line of the stanza. Find the next line that rhymes, and count the distance away in lines (so that the next line is 1, then 2, etc) of the next line that rhymes. Label the current line with this distance. If no subsequent line rhymes, label the current line 0. (In the implementation here, this lookahead is only done up to some `window size`, in our case 4; so no distances will be found that are greater than 4.) Continue until all lines are labeled.\n\n| regularized text                                       | final word | scheme | distance |\n| :----------------------------------------------------- | :--------- | :----- | :------- |\n| LO I the man, whose Muse whilom did mask,              | mask       | A      | 2        |\n| As time her taught, in lowly shepherds weeds,          | weeds      | B      | 2        |\n| Am now enforced a far unfitter task,                   | task       | A      | 0        |\n| For trumpets stern to change mine Oaten reeds:         | reeds      | B      | 1        |\n| And sing of Knights and Ladies gentle deeds,           | deeds      | B      | 2        |\n| Whose praises having slept in silence long,            | long       | C      | 2        |\n| Me, all too mean, the sacred Muse areeds               | areeds     | B      | 0        |\n| To blazon broad amongst her learned throng:            | throng     | C      | 1        |\n| Fierce wars and faithful loves shall moralise my song. | song       | C      | 0        |\n\nBoth schemes largely overlap in what information they convey (though they are not truly equivalent); in fact, the code that searches the corpus calculates the distance scheme directly, and the AB-scheme is later deduced from this. The distance scheme more transparently encodes the rhyme information as a graph, where each line is a node and the edges (connections) are intended rhymes. Implicit in both of these schemes are the line numbers themselves; this is reflected in the order of the labels. The table below makes these explicit, and for brevity removes the words themselves so now only the line and rhyme information remains.\n\n| line | scheme | distance |\n| :--- | :----- | :------- |\n| 1    | A      | 2        |\n| 2    | B      | 2        |\n| 3    | A      | 0        |\n| 4    | B      | 1        |\n| 5    | B      | 2        |\n| 6    | C      | 2        |\n| 7    | B      | 0        |\n| 8    | C      | 1        |\n| 9    | C      | 0        |\n\nThe table can now be read as follows: line 1 has its closest rhyme 2 lines away, line 2 has its closest rhyme 2 lines away, line 3 does not have any subsequent rhymes, and so on. Or after some arithmetic, line 1 rhymes with line 3 (current line 2 + distance 1), line 2 rhymes with line 4 (2+2), and so on. \n\n## Rhyme as a relation\n\nA [relation](https://en.wikipedia.org/wiki/Relation_(mathematics)) $R$ between elements of some set $S$ is a subset of $S \\times S$. In modeling the relation of rhyming, the set $S$ consists of words, and a pair of words are in $R$ if and only if they rhyme. Uncontroversally, (*bat*,*cat*) is in $R$, but (*bat*,*love*) is not. But the intensional definition of the rhyme relationship remains to be defined.\n\n### Perfect rhyme\n\nLet's first define an idealized notion of *perfect rhyme*. Intuitively, these are words that have *identical [rhyme stems](../terminology/rhyme_stem.qmd) *. Assume the rhyme stem so far is just the final sequence in the word consisting of the final vowel plus any following consonants. Let the relation of *perfect rhyme* $R_P$ be such that if two words have identical rhyme stems, they perfectly rhyme. *Bat perfectly rhymes with cat* is shorthand for (*bat*,*love*) $\\in R_P$. The relation $R_P$ is therefore an [equivalence relation](https://en.wikipedia.org/wiki/Equivalence_relation):\n\n1. $R_P$ is transitive: if A perfectly rhymes with B, and B perfectly rhymes with C, then A perfectly rhymes with C. \n2. $R_P$ is reflexive: for all words A, A perfectly rhymes with A.\n3. $R_P$ is symmetric: if A perfectly rhymes with B, then B perfectly rhymes with A. \n\n### Imperfect rhyme\n\nIn actuality, rhymes are not all perfect. Let's call relation of *imperfect rhyme* $R_I$. This relation is meant to reflect the set of word pairs actually found in rhyming position (or inferred to be in rhyming position) in the corpus. Intuitively, it should still be reflexive (words still rhyme with themselves) and symmetric (if A rhymes with B, then B rhymes with A), though the notion of transitivity is less clear. (Do there actually exist situations where A is judged to rhyme with B, and B is judged to rhyme with C, but A is not judged to rhyme with C?) Thus $R_I$ will not be treated as an equivalence relation *a priori* and instead the properties of it as a relationship will themselves be objects of study.\n\nAs the rhyme dictionary is not perfect, the actual set of pairs of words that are marked as rhyming will be an arbitrary collection (or at least, might trend towards an equivalence relation but will not categorically be one). For example, if a stanza is encountered that ends in the words \"thee\", \"be\", and \"see\", and only the pairs (\"thee\",\"see\") and (\"be\",\"see\") are present in the rhyming dictionary, then a connected set of rhyming words will be found, but with a loss of transitivity (since (\"thee\",\"be\") is not found). \n\nImplicit in the AB-scheme representation is that each rhyme group (or *letter*) is treated as an equivalence relationship: given a three-line stanza schemed AAAA, then it is (usually) safe to assume that line 1 rhymes with lines 2, 3, and 4; line 2 rhymes with 1, 3, 4; line 3 rhymes with 1, 2, and 4, and line 4 rhymes with 1, 2, and 3. Essentially, take any two rhyming words from this stanza, and they should rhyme.\n\nWhat the distances schemes show instead is show the pair-level information about what specific rhyme pairs exist in the stanza, at the behest of clearly showing the overall groups of words that rhyme. For example, in a hypothetical stanza with an AB-scheme of AAA, there are two consistent distance schemes:\n\n1. 110\n2. 210\n\n110 states that line 1 rhymes with line 2 (its next rhyme is a distance of 1 away), and that line 2 rhymes with line 3 (its next rhyme is also a distance of 1 away). This is what you would expect to find assuming a perfect rhyme relation with a dictionary to match. The distance scheme 210, however, says explicitly that line 1 rhymes with line 3 (being a distance of 2 away), and that line 2 also rhymes with line 3 (being a distance of 1 away). This still results in a connected subset of pairs you would expect to find in a perfect AAA representation of the stanza, but with the loss of transitivity regarding lines 1 and 2. It could be the case that the word pair from lines 1 and 2 is simply a gap in the dictionary (in which case it can be inferred), or it could be an accidental rhyme (maybe line 2 is not meant to rhyme with line 3 but the pair is erroneously in the rhyming dictionary). Such is a question for further investigation, but the crucial point here is that the distance scheme gives us a hint that something is not quite as expected. \n\n## Schemes as graphs\n\nA *graph*, in [purely mathematical terms](https://en.wikipedia.org/wiki/Graph_theory), is simply a pair of two sets: an *edge* set and a *vertex* (or node) set. Edges are connections between vertices (or nodes). For our purposes, the edge set of a rhyme graph will be the rhyming relation, and nodes are lines of poetry. A connection, then, between a node labeled \"1\" and a node labeled \"3\" indicates that lines 1 and 3 rhyme. Each type of rhyme scheme essentially encodes this information, so graphs will be used to both show the rhymes schemes visually but also to take advantage of the mathematical properties of graphs when working with rhyme schemes directly.\n\nThe connections from the previous table are shown as an explicit graph below; the positions of the nodes are arbitrary; the only information encoded is that which is explicitly shown (i.e. the edges and the nodes). \n\n```{dot}\n#| label: fig-distance-graph\n#| fig-cap: \"rhyme graph showing next closest rhyme for each line\"\n\ngraph G {\n  layout=neato;\n  label=\"rhyme graph showing next closest rhyme for each line\"\n  1 -- 3;\n  2 -- 4;\n  4 -- 5;\n  5 -- 7;\n  6 -- 8;\n  8 -- 9;\n}\n```\n\n\nThis graph has three separate, connected parts (or *components*). Each connected component represents a group of words that rhyme: the 1-3 component is the \"A\" group in terms of the AB-scheme, the 2-4-5-7 component the \"B\" group, and the 6-8-9 component the \"C\" group. Note that because this graph representation came directly from the distance scheme, we can annotate the graph with the words and rhyme groups from the original stanza for clarity.\n\n```{dot}\n\ngraph G {\n  layout=dot;\n  label=\"rhyme graph annotated with line-final words and AB-scheme groups\"\n  subgraph cluster_a {\n    penwidth=0;\n    label=\"\"\n    edge [label=\" A\"]\n    1 -- 3;\n  }\n  subgraph cluster_b {\n    label=\"\"\n    penwidth=0;\n    edge [label=\" B\"]\n    2 -- 4;\n    4 -- 5;\n    5 -- 7;\n  }\n  subgraph cluster_c {\n    label=\"\"\n    penwidth=0;\n    edge [label=\" C\"]\n    6 -- 8;\n    8 -- 9;\n  }\n\n  1 [label=\"1 mask\"]\n  2 [label=\"2 weeds\"]\n  3 [label=\"3 task\"]\n  4 [label=\"4 reeds\"]\n  5 [label=\"5 deeds\"]\n  6 [label=\"6 long\"]\n  7 [label=\"7 areeds\"]\n  8 [label=\"8 throng\"]\n  9 [label=\"9 song\"]\n}\n```\n\nThe rhyme graph now clearly shows six different connections between nodes, or rather 6 calculated rhymes. The previous two graphs encode the same type of rhyme scheme, the only difference is how they are visually presented. \n\nSome things to note at this point: the rhyme search procedure of the corpus looks for only the next closest rhyme before moving on, thus if an intended scheme is AAA, then lines 1 and 2 are connected, as well as 2 and 3, but the connection between 1 and 3 is not explicitly shown. These can be added for any graph by calculating the [*transitive closure*](https://en.wikipedia.org/wiki/Transitive_closure) of that graph, but since we are building our graphs based on the results of the code directly they are not shown in the above examples. In other words, the graphs built from the distance schemes directly are the [transitive reduction](https://en.wikipedia.org/wiki/Transitive_reduction) of the intended rhyming relation. \n\n\n## Oneoffs and rhyme scheme comparisons\n\nThe rhyme search procedure is not perfect. There are both false negatives--intended rhyme pairs that the search missed--and false positives--words tagged as a rhyme that are not intended to rhyme. Among other things, this means that if there is a target scheme in mind, such as Rhyme Royal (ABABBCC), there are a number of considerations to take when searching for this exact scheme and tagged schemes that are close to this scheme.\n\nThe general focus of this section is to answer the question: given two schemes, how can we quantify how similar/different they are?\n\n### String edit distance\n\n[String edit distance](https://en.wikipedia.org/wiki/Levenshtein_distance) is a measure of how different two strings (linear sequences of symbols) are, by measuring additions, removals, and substitutions between them. For example, *bat* and *cat* have an edit distance of 1 (1 substitution), while *bat* and *cats* have a distance of 2 (1 substitution and 1 addition). \n\nAs both an AB-scheme and a distance scheme can be represented as simply a string of characters: say, ABABBCBCC and 220122010, it is tempting to compare scheme similarity with edit distance; however, **edit distance should only be used with distance schemes**. \n\nConsider a starting distance scheme of 220122010 (ABABBCBCC in AB-scheme terms). There are exactly six oneoffs of these scheme. A **oneoff** is a scheme that is identical to the original but with one fewer rhyme pair. These are all enumerated in the table below. Each row shows the resulting distance scheme, and the pair of line numbers that is missing from the oneoff but present in the target scheme. \n\n```{python}\n#| label: fig-oneoff-comp\n#| fig-cap: \"Comparing the oneoffs of 220122010\"\n\ntarget_distance = [int(x) for x in '220122010']\noneoffs = get_oneoffs(target_distance)\noneoff_dict = defaultdict(list)\nfor oo, dist in oneoffs.items():\n    ab_scheme = distances_to_ab(dist)\n    dist_str = ''.join([str(d) for d in dist])\n    oneoff_dict['ab_scheme'].append(ab_scheme)\n    oneoff_dict['dist_str'].append(dist_str)\n    oneoff_dict['pair_removed'].append(oo)\n    oneoff_dict['distances'].append(dist)\n\ndf = pd.DataFrame(oneoff_dict)\ndf['target_ab'] = distances_to_ab(target_distance)\ndf['target_dist'] = ''.join([str(d) for d in target_distance])\n\ndf['ab_edit_distance'] = df.apply(lambda x: d.levenshtein(x['ab_scheme'], x['target_ab']),axis=1)\ndf['dist_edit_distance'] = df.apply(lambda x: d.levenshtein(x['dist_str'], x['target_dist']),axis=1)\n\nkeep = \"ab_scheme dist_str pair_removed ab_edit_distance dist_edit_distance\".split()\n\ndf[keep]\n```\n\nThe `ab_edit_distance` column simply takes the AB-schemes as strings and calculates the string edit distance between them. Note that in general, *the earlier in the stanza the rhyme difference is, the higher this edit distance is likely to be*, since an early change in how a line is labeled will propagate down to the rest of the linegroup. This is **not** a recommended way to compare line schemes. \n\nHowever, taking the **distance schemes** as strings, and comparing those with string edit distance, gives a reliable count of the differences between the two schemes in question. Every oneoff has a count of 1 in the `dist_edit_distance` column, as in this representation, if two strings are identical except for a single rhyme, they will differ in only the position of the first word in that rhyme pair. \n\n| Name           | Distance Scheme | AB-scheme   |\n| :------------- | :-------------- | :---------- |\n| Target scheme  | `220122010`     | `ABABBCBCC` |\n| Example oneoff | `020122010`     | `ABCBBDBDD` |\n| Edit distance  | 1               | 4           |\n\n(in progress)","srcMarkdownNoYaml":"\n\n```{python}\n## code preamble\n\nfrom rhyme_functions import *\n# import pygraphviz as pgv\nfrom pyeditdistance import distance as d\nimport pandas as pd\nimport graphviz\nfrom IPython.display import Image\n```\n\n## Introduction\n\nRhyme scheme information is presented in the tagged linegroup data in a variety of ways. One column contains the standard AABB-style rhyme schemes (henceforth 'AB-scheme'), and another contains the `rhyme_distances` (hereafter 'distance scheme'). In most situations where you will be searching, filtering, and comparing rhyme schemes, especially with the use of code, the rhyme distances will provide more flexibility and generality. \n\n### Types of schemes\n\n#### AB-schemes\n\nTo construct an AB-scheme generally, start at the last word of the first line of the stanza. Label this line 'A'. Any subsequent line that rhymes (meaning, the last word of that line rhymes with the last word of the current line), label those lines 'A'. Move to the next unlabeled line, and continue labeling with 'B', and so on, until all lines are labeled. \n\n| regularized text                                       | final word | AB-scheme |\n| :----------------------------------------------------- | :--------- | :-------- |\n| LO I the man, whose Muse whilom did mask,              | mask       | A         |\n| As time her taught, in lowly shepherds weeds,          | weeds      | B         |\n| Am now enforced a far unfitter task,                   | task       | A         |\n| For trumpets stern to change mine Oaten reeds:         | reeds      | B         |\n| And sing of Knights and Ladies gentle deeds,           | deeds      | B         |\n| Whose praises having slept in silence long,            | long       | C         |\n| Me, all too mean, the sacred Muse areeds               | areeds     | B         |\n| To blazon broad amongst her learned throng:            | throng     | C         |\n| Fierce wars and faithful loves shall moralise my song. | song       | C         |\n\n#### Distance schemes\n\nTo construct a distance scheme, start at the first line of the stanza. Find the next line that rhymes, and count the distance away in lines (so that the next line is 1, then 2, etc) of the next line that rhymes. Label the current line with this distance. If no subsequent line rhymes, label the current line 0. (In the implementation here, this lookahead is only done up to some `window size`, in our case 4; so no distances will be found that are greater than 4.) Continue until all lines are labeled.\n\n| regularized text                                       | final word | scheme | distance |\n| :----------------------------------------------------- | :--------- | :----- | :------- |\n| LO I the man, whose Muse whilom did mask,              | mask       | A      | 2        |\n| As time her taught, in lowly shepherds weeds,          | weeds      | B      | 2        |\n| Am now enforced a far unfitter task,                   | task       | A      | 0        |\n| For trumpets stern to change mine Oaten reeds:         | reeds      | B      | 1        |\n| And sing of Knights and Ladies gentle deeds,           | deeds      | B      | 2        |\n| Whose praises having slept in silence long,            | long       | C      | 2        |\n| Me, all too mean, the sacred Muse areeds               | areeds     | B      | 0        |\n| To blazon broad amongst her learned throng:            | throng     | C      | 1        |\n| Fierce wars and faithful loves shall moralise my song. | song       | C      | 0        |\n\nBoth schemes largely overlap in what information they convey (though they are not truly equivalent); in fact, the code that searches the corpus calculates the distance scheme directly, and the AB-scheme is later deduced from this. The distance scheme more transparently encodes the rhyme information as a graph, where each line is a node and the edges (connections) are intended rhymes. Implicit in both of these schemes are the line numbers themselves; this is reflected in the order of the labels. The table below makes these explicit, and for brevity removes the words themselves so now only the line and rhyme information remains.\n\n| line | scheme | distance |\n| :--- | :----- | :------- |\n| 1    | A      | 2        |\n| 2    | B      | 2        |\n| 3    | A      | 0        |\n| 4    | B      | 1        |\n| 5    | B      | 2        |\n| 6    | C      | 2        |\n| 7    | B      | 0        |\n| 8    | C      | 1        |\n| 9    | C      | 0        |\n\nThe table can now be read as follows: line 1 has its closest rhyme 2 lines away, line 2 has its closest rhyme 2 lines away, line 3 does not have any subsequent rhymes, and so on. Or after some arithmetic, line 1 rhymes with line 3 (current line 2 + distance 1), line 2 rhymes with line 4 (2+2), and so on. \n\n## Rhyme as a relation\n\nA [relation](https://en.wikipedia.org/wiki/Relation_(mathematics)) $R$ between elements of some set $S$ is a subset of $S \\times S$. In modeling the relation of rhyming, the set $S$ consists of words, and a pair of words are in $R$ if and only if they rhyme. Uncontroversally, (*bat*,*cat*) is in $R$, but (*bat*,*love*) is not. But the intensional definition of the rhyme relationship remains to be defined.\n\n### Perfect rhyme\n\nLet's first define an idealized notion of *perfect rhyme*. Intuitively, these are words that have *identical [rhyme stems](../terminology/rhyme_stem.qmd) *. Assume the rhyme stem so far is just the final sequence in the word consisting of the final vowel plus any following consonants. Let the relation of *perfect rhyme* $R_P$ be such that if two words have identical rhyme stems, they perfectly rhyme. *Bat perfectly rhymes with cat* is shorthand for (*bat*,*love*) $\\in R_P$. The relation $R_P$ is therefore an [equivalence relation](https://en.wikipedia.org/wiki/Equivalence_relation):\n\n1. $R_P$ is transitive: if A perfectly rhymes with B, and B perfectly rhymes with C, then A perfectly rhymes with C. \n2. $R_P$ is reflexive: for all words A, A perfectly rhymes with A.\n3. $R_P$ is symmetric: if A perfectly rhymes with B, then B perfectly rhymes with A. \n\n### Imperfect rhyme\n\nIn actuality, rhymes are not all perfect. Let's call relation of *imperfect rhyme* $R_I$. This relation is meant to reflect the set of word pairs actually found in rhyming position (or inferred to be in rhyming position) in the corpus. Intuitively, it should still be reflexive (words still rhyme with themselves) and symmetric (if A rhymes with B, then B rhymes with A), though the notion of transitivity is less clear. (Do there actually exist situations where A is judged to rhyme with B, and B is judged to rhyme with C, but A is not judged to rhyme with C?) Thus $R_I$ will not be treated as an equivalence relation *a priori* and instead the properties of it as a relationship will themselves be objects of study.\n\nAs the rhyme dictionary is not perfect, the actual set of pairs of words that are marked as rhyming will be an arbitrary collection (or at least, might trend towards an equivalence relation but will not categorically be one). For example, if a stanza is encountered that ends in the words \"thee\", \"be\", and \"see\", and only the pairs (\"thee\",\"see\") and (\"be\",\"see\") are present in the rhyming dictionary, then a connected set of rhyming words will be found, but with a loss of transitivity (since (\"thee\",\"be\") is not found). \n\nImplicit in the AB-scheme representation is that each rhyme group (or *letter*) is treated as an equivalence relationship: given a three-line stanza schemed AAAA, then it is (usually) safe to assume that line 1 rhymes with lines 2, 3, and 4; line 2 rhymes with 1, 3, 4; line 3 rhymes with 1, 2, and 4, and line 4 rhymes with 1, 2, and 3. Essentially, take any two rhyming words from this stanza, and they should rhyme.\n\nWhat the distances schemes show instead is show the pair-level information about what specific rhyme pairs exist in the stanza, at the behest of clearly showing the overall groups of words that rhyme. For example, in a hypothetical stanza with an AB-scheme of AAA, there are two consistent distance schemes:\n\n1. 110\n2. 210\n\n110 states that line 1 rhymes with line 2 (its next rhyme is a distance of 1 away), and that line 2 rhymes with line 3 (its next rhyme is also a distance of 1 away). This is what you would expect to find assuming a perfect rhyme relation with a dictionary to match. The distance scheme 210, however, says explicitly that line 1 rhymes with line 3 (being a distance of 2 away), and that line 2 also rhymes with line 3 (being a distance of 1 away). This still results in a connected subset of pairs you would expect to find in a perfect AAA representation of the stanza, but with the loss of transitivity regarding lines 1 and 2. It could be the case that the word pair from lines 1 and 2 is simply a gap in the dictionary (in which case it can be inferred), or it could be an accidental rhyme (maybe line 2 is not meant to rhyme with line 3 but the pair is erroneously in the rhyming dictionary). Such is a question for further investigation, but the crucial point here is that the distance scheme gives us a hint that something is not quite as expected. \n\n## Schemes as graphs\n\nA *graph*, in [purely mathematical terms](https://en.wikipedia.org/wiki/Graph_theory), is simply a pair of two sets: an *edge* set and a *vertex* (or node) set. Edges are connections between vertices (or nodes). For our purposes, the edge set of a rhyme graph will be the rhyming relation, and nodes are lines of poetry. A connection, then, between a node labeled \"1\" and a node labeled \"3\" indicates that lines 1 and 3 rhyme. Each type of rhyme scheme essentially encodes this information, so graphs will be used to both show the rhymes schemes visually but also to take advantage of the mathematical properties of graphs when working with rhyme schemes directly.\n\nThe connections from the previous table are shown as an explicit graph below; the positions of the nodes are arbitrary; the only information encoded is that which is explicitly shown (i.e. the edges and the nodes). \n\n```{dot}\n#| label: fig-distance-graph\n#| fig-cap: \"rhyme graph showing next closest rhyme for each line\"\n\ngraph G {\n  layout=neato;\n  label=\"rhyme graph showing next closest rhyme for each line\"\n  1 -- 3;\n  2 -- 4;\n  4 -- 5;\n  5 -- 7;\n  6 -- 8;\n  8 -- 9;\n}\n```\n\n\nThis graph has three separate, connected parts (or *components*). Each connected component represents a group of words that rhyme: the 1-3 component is the \"A\" group in terms of the AB-scheme, the 2-4-5-7 component the \"B\" group, and the 6-8-9 component the \"C\" group. Note that because this graph representation came directly from the distance scheme, we can annotate the graph with the words and rhyme groups from the original stanza for clarity.\n\n```{dot}\n\ngraph G {\n  layout=dot;\n  label=\"rhyme graph annotated with line-final words and AB-scheme groups\"\n  subgraph cluster_a {\n    penwidth=0;\n    label=\"\"\n    edge [label=\" A\"]\n    1 -- 3;\n  }\n  subgraph cluster_b {\n    label=\"\"\n    penwidth=0;\n    edge [label=\" B\"]\n    2 -- 4;\n    4 -- 5;\n    5 -- 7;\n  }\n  subgraph cluster_c {\n    label=\"\"\n    penwidth=0;\n    edge [label=\" C\"]\n    6 -- 8;\n    8 -- 9;\n  }\n\n  1 [label=\"1 mask\"]\n  2 [label=\"2 weeds\"]\n  3 [label=\"3 task\"]\n  4 [label=\"4 reeds\"]\n  5 [label=\"5 deeds\"]\n  6 [label=\"6 long\"]\n  7 [label=\"7 areeds\"]\n  8 [label=\"8 throng\"]\n  9 [label=\"9 song\"]\n}\n```\n\nThe rhyme graph now clearly shows six different connections between nodes, or rather 6 calculated rhymes. The previous two graphs encode the same type of rhyme scheme, the only difference is how they are visually presented. \n\nSome things to note at this point: the rhyme search procedure of the corpus looks for only the next closest rhyme before moving on, thus if an intended scheme is AAA, then lines 1 and 2 are connected, as well as 2 and 3, but the connection between 1 and 3 is not explicitly shown. These can be added for any graph by calculating the [*transitive closure*](https://en.wikipedia.org/wiki/Transitive_closure) of that graph, but since we are building our graphs based on the results of the code directly they are not shown in the above examples. In other words, the graphs built from the distance schemes directly are the [transitive reduction](https://en.wikipedia.org/wiki/Transitive_reduction) of the intended rhyming relation. \n\n\n## Oneoffs and rhyme scheme comparisons\n\nThe rhyme search procedure is not perfect. There are both false negatives--intended rhyme pairs that the search missed--and false positives--words tagged as a rhyme that are not intended to rhyme. Among other things, this means that if there is a target scheme in mind, such as Rhyme Royal (ABABBCC), there are a number of considerations to take when searching for this exact scheme and tagged schemes that are close to this scheme.\n\nThe general focus of this section is to answer the question: given two schemes, how can we quantify how similar/different they are?\n\n### String edit distance\n\n[String edit distance](https://en.wikipedia.org/wiki/Levenshtein_distance) is a measure of how different two strings (linear sequences of symbols) are, by measuring additions, removals, and substitutions between them. For example, *bat* and *cat* have an edit distance of 1 (1 substitution), while *bat* and *cats* have a distance of 2 (1 substitution and 1 addition). \n\nAs both an AB-scheme and a distance scheme can be represented as simply a string of characters: say, ABABBCBCC and 220122010, it is tempting to compare scheme similarity with edit distance; however, **edit distance should only be used with distance schemes**. \n\nConsider a starting distance scheme of 220122010 (ABABBCBCC in AB-scheme terms). There are exactly six oneoffs of these scheme. A **oneoff** is a scheme that is identical to the original but with one fewer rhyme pair. These are all enumerated in the table below. Each row shows the resulting distance scheme, and the pair of line numbers that is missing from the oneoff but present in the target scheme. \n\n```{python}\n#| label: fig-oneoff-comp\n#| fig-cap: \"Comparing the oneoffs of 220122010\"\n\ntarget_distance = [int(x) for x in '220122010']\noneoffs = get_oneoffs(target_distance)\noneoff_dict = defaultdict(list)\nfor oo, dist in oneoffs.items():\n    ab_scheme = distances_to_ab(dist)\n    dist_str = ''.join([str(d) for d in dist])\n    oneoff_dict['ab_scheme'].append(ab_scheme)\n    oneoff_dict['dist_str'].append(dist_str)\n    oneoff_dict['pair_removed'].append(oo)\n    oneoff_dict['distances'].append(dist)\n\ndf = pd.DataFrame(oneoff_dict)\ndf['target_ab'] = distances_to_ab(target_distance)\ndf['target_dist'] = ''.join([str(d) for d in target_distance])\n\ndf['ab_edit_distance'] = df.apply(lambda x: d.levenshtein(x['ab_scheme'], x['target_ab']),axis=1)\ndf['dist_edit_distance'] = df.apply(lambda x: d.levenshtein(x['dist_str'], x['target_dist']),axis=1)\n\nkeep = \"ab_scheme dist_str pair_removed ab_edit_distance dist_edit_distance\".split()\n\ndf[keep]\n```\n\nThe `ab_edit_distance` column simply takes the AB-schemes as strings and calculates the string edit distance between them. Note that in general, *the earlier in the stanza the rhyme difference is, the higher this edit distance is likely to be*, since an early change in how a line is labeled will propagate down to the rest of the linegroup. This is **not** a recommended way to compare line schemes. \n\nHowever, taking the **distance schemes** as strings, and comparing those with string edit distance, gives a reliable count of the differences between the two schemes in question. Every oneoff has a count of 1 in the `dist_edit_distance` column, as in this representation, if two strings are identical except for a single rhyme, they will differ in only the position of the first word in that rhyme pair. \n\n| Name           | Distance Scheme | AB-scheme   |\n| :------------- | :-------------- | :---------- |\n| Target scheme  | `220122010`     | `ABABBCBCC` |\n| Example oneoff | `020122010`     | `ABCBBDBDD` |\n| Edit distance  | 1               | 4           |\n\n(in progress)"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"toc-depth":6,"output-file":"rhyme-distances.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.554","theme":"cosmo","toc-title":"Contents","title":"Working with rhyme distances","author":"Nick Danis","date":"last-modified"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}